<div class="card" style="width: 100%;">
  <div class="card-body">
    <% provide(:title, @item.name) %>
    <div class= "text-center">

      <% if !@item.images.empty? %>
    
      <div id="MyCarousel" class="carousel slide carousel-fade" data-ride="carousel">
        <div class="carousel-inner" role="listbox">
          <div class="carousel-item active">
            <%= image_tag(@item.images.first, style: 'height:100px;width:auto;') %>
          </div>
          <% @item.images.drop(1).each do |photo| %>
            <div class="carousel-item">
              <%= image_tag(photo, style: 'height:100px;width:auto;') %>
            </div>
          <% end %>
        </div>

          <ol class="carousel-indicators">
          <% @item.images.each_with_index do |photo, n| %>
            <li data-target='#MyCarousel' data-slide-to="#{n}" class="#{'active' if n == 0}"></li>
          <% end %>
          </ol>
        </div>
      <% end %>

    
      <h5 class="card-title text-center mt-2"><%= @item.name %></h5>
      <p class="card-text text-center"><%= @item.category %></p>
      <p class="card-text text-center"><%= @item.user_id %></p>
      <p class="card-text text-center"><%= @item.created_at %></p>
      <p class="card-text text-center"><%= @item.popularity %></p>
    </div>
  </div>
</div>

<% if @item.trade_established %>
  <p>This item has been traded! You came too late lah.</p>
  <p>
    It was traded with
    <%= link_to "\"#{@traded_item.name}\"", @traded_item %>
  </p>
  
<% else %>
  <% if logged_in? %>
    <% if @item.user_id == current_user.id %>
      <p>
        <strong> Other people want to trade <%=@item.name%> with :</strong>
          <table>
            <tbody>
              <tbody>
              <% @item.bid_by.each do |item| %>
                <tr>
                <div class="container">
                <div class="card-deck flex-row flex-nowrap">
                  <a href="/items/<%= item.id %>">
                  <div class="card" style="width: 100%;">
                    <div class="card-body">
                      <% provide(:title, item.name) %>
                      <div class= "text-center">

                        <% if !item.images.empty? %>
                      
                        <div id="MyCarousel" class="carousel slide carousel-fade" data-ride="carousel">
                          <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active">
                              <%= image_tag(item.images.first, style: 'height:100px;width:auto;') %>
                            </div>
                            <% item.images.drop(1).each do |photo| %>
                              <div class="carousel-item">
                                <%= image_tag(photo, style: 'height:100px;width:auto;') %>
                              </div>
                            <% end %>
                          </div>
              
                            <ol class="carousel-indicators">
                            <% item.images.each_with_index do |photo, n| %>
                              <li data-target='#MyCarousel' data-slide-to="#{n}" class="#{'active' if n == 0}"></li>
                            <% end %>
                            </ol>
                          </div>
                        <% end %>

                      
                        <h5 class="card-title text-center mt-2"><%= item.name %></h5>
                        <p class="card-text text-center"><%= item.category %></p>
                        <p class="card-text text-center"><%= item.created_at %></p>
                        <p class="card-text text-center"><%= link_to 'Trade', add_trade_item_path(@item, :bid_id => item.id), method: :post  %></p>
                      </div>
                    </div>
                  </div>
                  </a>
                  </div>
                  </div>
                </tr>
              <% end %>
            </tbody>

            </tbody>
          </table>
      </p>
    <% else %>
      <p>
        <strong> Select items you want to trade for <%=@item.name%> :</strong>
          <table>
            
            <tbody>
              <% current_user.items.each do |item| %>
                <% unless item.trade_established %>
                  <tr>
                  <div class="container">
                  <div class="card-deck flex-row flex-nowrap">
                  <a href="/items/<%= item.id %>">
                    <div class="card" style="width: 100%;">
                    <div class="card-body">
                      <% provide(:title, item.name) %>
                      <div class= "text-center">

                        <% if !item.images.empty? %>
                      
                        <div id="MyCarousel" class="carousel slide carousel-fade" data-ride="carousel">
                          <div class="carousel-inner" role="listbox">
                            <div class="carousel-item active">
                              <%= image_tag(item.images.first, style: 'height:100px;width:auto;') %>
                            </div>
                            <% item.images.drop(1).each do |photo| %>
                              <div class="carousel-item">
                                <%= image_tag(photo, style: 'height:100px;width:auto;') %>
                              </div>
                            <% end %>
                          </div>
              
                            <ol class="carousel-indicators">
                            <% item.images.each_with_index do |photo, n| %>
                              <li data-target='#MyCarousel' data-slide-to="#{n}" class="#{'active' if n == 0}"></li>
                            <% end %>
                            </ol>
                          </div>
                        <% end %>

                      
                        <h5 class="card-title text-center mt-2"><%= item.name %></h5>
                        <p class="card-text text-center"><%= item.category %></p>
                        <p class="card-text text-center"><%= item.created_at %></p>
                        <% if !@item.bid_by.include?(item) %>
                          <p class="card-text text-center"><%= link_to 'Trade', add_trade_item_path(@item, :bid_id => item.id), method: :post  %></p>
                        <% else %>
                          <p class="card-text text-center"><%= link_to 'Cancel', cancel_bid_item_path(@item, :bid_id => item.id), method: :post %></p>
                        <% end %>
                      </div>
                    </div>
                  </div>

                  </a>
                  </div>
                  </div>


                  </tr>
                <% end %>
              <% end %>
            </tbody>
          </table>
      </p>
    <% end %>
  <% end %> 
<% end %>


<% if logged_in? && @item.user_id == current_user.id %>
  <%= link_to 'Edit', edit_item_path(@item) %> |
<% end %> 
<%= link_to 'Back', session[:return_to] %>
